<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyToken - MetaMaské›†æˆæ¼”ç¤º</title>
    <!-- Web3.jsåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
        }
        .token-info {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 2px solid #e9ecef;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .info-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        .info-card h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .info-card .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #4CAF50;
        }
        .functions {
            padding: 30px;
        }
        .function-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .function-section h3 {
            color: #333;
            margin-top: 0;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: #4CAF50;
            outline: none;
        }
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            transition: background 0.3s;
        }
        .btn:hover {
            background: #45a049;
        }
        .btn.danger {
            background: #f44336;
        }
        .btn.danger:hover {
            background: #da190b;
        }
        .btn.warning {
            background: #ff9800;
        }
        .btn.warning:hover {
            background: #e68900;
        }
        .transactions {
            padding: 0 30px 30px;
        }
        .transaction-list {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        .transaction-item {
            background: white;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-active {
            background: #4CAF50;
        }
        .status-paused {
            background: #ff9800;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            display: none;
        }
        .notification.success {
            background: #4CAF50;
        }
        .notification.error {
            background: #f44336;
        }
        .notification.warning {
            background: #ff9800;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ StudyToken (STU)</h1>
            <p>å­¦ä¹ æ•™è‚²ä»£å¸ - MetaMaské›†æˆæ¼”ç¤º</p>
            <div style="margin-top: 20px;">
                <button class="btn" id="connectWallet" onclick="connectMetaMask()">ğŸ¦Š è¿æ¥MetaMask</button>
                <button class="btn warning" id="disconnectWallet" onclick="disconnectMetaMask()" style="display: none;">æ–­å¼€è¿æ¥</button>
                <span id="walletInfo" style="margin-left: 20px; color: white;"></span>
            </div>
        </div>
        <!-- MetaMaské’±åŒ…çŠ¶æ€ -->
        <div class="token-info" style="background: #e3f2fd; border-bottom: 2px solid #2196f3;">
            <div class="info-grid">
                <div class="info-card">
                    <h3>ğŸ¦Š é’±åŒ…çŠ¶æ€</h3>
                    <div class="value" id="walletStatus" style="color: #2196f3;">æœªè¿æ¥</div>
                </div>
                <div class="info-card">
                    <h3>å½“å‰è´¦æˆ·</h3>
                    <div class="value" id="currentAccount" style="font-size: 0.9em; color: #2196f3;">æœªè¿æ¥</div>
                </div>
                <div class="info-card">
                    <h3>ç½‘ç»œ</h3>
                    <div class="value" id="networkName" style="color: #2196f3;">æœªè¿æ¥</div>
                </div>
                <div class="info-card">
                    <h3>ETHä½™é¢</h3>
                    <div class="value" id="ethBalance" style="color: #2196f3;">0 ETH</div>
                </div>
            </div>
        </div>

        <div class="token-info">
            <div class="info-grid">
                <div class="info-card">
                    <h3>æ€»ä¾›åº”é‡</h3>
                    <div class="value" id="totalSupply">1,000,000 STU</div>
                </div>
                <div class="info-card">
                    <h3>æµé€šé‡</h3>
                    <div class="value" id="circulatingSupply">900,000 STU</div>
                </div>
                <div class="info-card">
                    <h3>ç®¡ç†å‘˜ä½™é¢</h3>
                    <div class="value" id="adminBalance">100,000 STU</div>
                </div>
                <div class="info-card">
                    <h3>åˆçº¦çŠ¶æ€</h3>
                    <div class="value">
                        <span class="status-indicator status-active"></span>
                        <span id="contractStatus">è¿è¡Œä¸­</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="functions">
            <!-- é“¸é€ åŠŸèƒ½ -->
            <div class="function-section">
                <h3>ğŸª™ é“¸é€ ä»£å¸ (ç®¡ç†å‘˜åŠŸèƒ½)</h3>
                <div class="form-group">
                    <label>æ¥æ”¶åœ°å€:</label>
                    <input type="text" id="mintAddress" placeholder="0x..." value="0xStudent123456789">
                </div>
                <div class="form-group">
                    <label>é“¸é€ æ•°é‡:</label>
                    <input type="number" id="mintAmount" placeholder="è¾“å…¥STUæ•°é‡" value="100">
                </div>
                <div class="form-group">
                    <label>é“¸é€ åŸå› :</label>
                    <select id="mintReason">
                        <option value="å­¦ä¹ æˆå°±">å­¦ä¹ æˆå°±</option>
                        <option value="è¯¾ç¨‹å®Œæˆ">è¯¾ç¨‹å®Œæˆ</option>
                        <option value="ä¼˜ç§€è¡¨ç°">ä¼˜ç§€è¡¨ç°</option>
                        <option value="ç‰¹åˆ«å¥–åŠ±">ç‰¹åˆ«å¥–åŠ±</option>
                    </select>
                </div>
                <button class="btn" onclick="mintTokens()">é“¸é€ ä»£å¸</button>
                <button class="btn warning" onclick="mintSimple()">ç®€åŒ–é“¸é€ </button>
            </div>

            <!-- è½¬ç§»åŠŸèƒ½ -->
            <div class="function-section">
                <h3>ğŸ’¸ è½¬ç§»ä»£å¸</h3>
                <div class="form-group">
                    <label>å‘é€åœ°å€:</label>
                    <input type="text" id="fromAddress" placeholder="0x..." value="0xStudent123456789">
                </div>
                <div class="form-group">
                    <label>æ¥æ”¶åœ°å€:</label>
                    <input type="text" id="toAddress" placeholder="0x..." value="0xTeacher987654321">
                </div>
                <div class="form-group">
                    <label>è½¬ç§»æ•°é‡:</label>
                    <input type="number" id="transferAmount" placeholder="è¾“å…¥STUæ•°é‡" value="50">
                </div>
                <button class="btn" onclick="transferTokens()">è½¬ç§»ä»£å¸</button>
            </div>

            <!-- é”€æ¯åŠŸèƒ½ -->
            <div class="function-section">
                <h3>ğŸ”¥ é”€æ¯ä»£å¸ (æœåŠ¡å…‘æ¢)</h3>
                <div class="form-group">
                    <label>é”€æ¯åœ°å€:</label>
                    <input type="text" id="burnAddress" placeholder="0x..." value="0xStudent123456789">
                </div>
                <div class="form-group">
                    <label>é”€æ¯æ•°é‡:</label>
                    <input type="number" id="burnAmount" placeholder="è¾“å…¥STUæ•°é‡" value="25">
                </div>
                <div class="form-group">
                    <label>å…‘æ¢æœåŠ¡:</label>
                    <select id="burnReason">
                        <option value="è¯¾ç¨‹å…‘æ¢">è¯¾ç¨‹å…‘æ¢</option>
                        <option value="å’¨è¯¢æœåŠ¡">å’¨è¯¢æœåŠ¡</option>
                        <option value="ææ–™ä¸‹è½½">ææ–™ä¸‹è½½</option>
                        <option value="è¯ä¹¦ç”³è¯·">è¯ä¹¦ç”³è¯·</option>
                    </select>
                </div>
                <button class="btn danger" onclick="burnTokens()">é”€æ¯ä»£å¸</button>
            </div>

            <!-- ç®¡ç†åŠŸèƒ½ -->
            <div class="function-section">
                <h3>âš™ï¸ åˆçº¦ç®¡ç† (ç®¡ç†å‘˜åŠŸèƒ½)</h3>
                <button class="btn warning" onclick="pauseContract()">æš‚åœåˆçº¦</button>
                <button class="btn" onclick="unpauseContract()">æ¢å¤åˆçº¦</button>
                <button class="btn" onclick="emergencyPause()">ç´§æ€¥æš‚åœ</button>
                <button class="btn" onclick="refreshInfo()">åˆ·æ–°ä¿¡æ¯</button>
            </div>
        </div>

        <div class="transactions">
            <h3>ğŸ“‹ äº¤æ˜“å†å²</h3>
            <div class="transaction-list" id="transactionList">
                <div class="transaction-item">
                    <strong>åˆå§‹åŒ–</strong> - é“¸é€  1,000,000 STU ç»™ç®¡ç†å‘˜ (åˆå§‹ä¾›åº”)
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // Web3å’ŒMetaMaskç›¸å…³å˜é‡
        let web3;
        let currentAccount = null;
        let contractInstance = null;
        
        // åˆçº¦é…ç½® (ç¤ºä¾‹é…ç½®ï¼Œå®é™…éƒ¨ç½²æ—¶éœ€è¦æ›¿æ¢)
        const CONTRACT_ADDRESS = "0x1234567890123456789012345678901234567890"; // æ›¿æ¢ä¸ºå®é™…åˆçº¦åœ°å€
        const CONTRACT_ABI = [
            {
                "constant": true,
                "inputs": [],
                "name": "name",
                "outputs": [{"name": "", "type": "string"}],
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "symbol",
                "outputs": [{"name": "", "type": "string"}],
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "totalSupply",
                "outputs": [{"name": "", "type": "uint256"}],
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [{"name": "_owner", "type": "address"}],
                "name": "balanceOf",
                "outputs": [{"name": "balance", "type": "uint256"}],
                "type": "function"
            },
            {
                "constant": false,
                "inputs": [
                    {"name": "_to", "type": "address"},
                    {"name": "_value", "type": "uint256"}
                ],
                "name": "transfer",
                "outputs": [{"name": "", "type": "bool"}],
                "type": "function"
            },
            {
                "constant": false,
                "inputs": [
                    {"name": "_to", "type": "address"},
                    {"name": "_amount", "type": "uint256"},
                    {"name": "_reason", "type": "string"}
                ],
                "name": "mint",
                "outputs": [],
                "type": "function"
            },
            {
                "constant": false,
                "inputs": [{"name": "_amount", "type": "uint256"}],
                "name": "burn",
                "outputs": [],
                "type": "function"
            }
        ];

        // æ¨¡æ‹Ÿæ•°æ® (å½“æ²¡æœ‰è¿æ¥çœŸå®åˆçº¦æ—¶ä½¿ç”¨)
        let contractData = {
            totalSupply: 1000000,
            circulatingSupply: 900000,
            adminBalance: 100000,
            isPaused: false,
            balances: {
                '0xStudent123456789': 50000,
                '0xTeacher987654321': 25000
            }
        };

        // ç½‘ç»œé…ç½®
        const SUPPORTED_NETWORKS = {
            1: { name: "Ethereum Mainnet", chainId: "0x1" },
            3: { name: "Ropsten Testnet", chainId: "0x3" },
            4: { name: "Rinkeby Testnet", chainId: "0x4" },
            5: { name: "Goerli Testnet", chainId: "0x5" },
            11155111: { name: "Sepolia Testnet", chainId: "0xaa36a7" },
            97: { name: "BSC Testnet", chainId: "0x61" },
            56: { name: "BSC Mainnet", chainId: "0x38" }
        };

        // è¿æ¥MetaMaské’±åŒ…
        async function connectMetaMask() {
            console.log('å¼€å§‹è¿æ¥MetaMask...');
            
            if (typeof window.ethereum === 'undefined') {
                console.log('MetaMaskæœªå®‰è£…');
                showNotification('è¯·å®‰è£…MetaMaské’±åŒ…ï¼', 'error');
                window.open('https://metamask.io/download/', '_blank');
                return;
            }

            try {
                console.log('è¯·æ±‚è´¦æˆ·è¿æ¥...');
                // è¯·æ±‚è¿æ¥è´¦æˆ·
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                console.log('è·å–åˆ°è´¦æˆ·:', accounts);
                
                if (accounts.length > 0) {
                    currentAccount = accounts[0];
                    web3 = new Web3(window.ethereum);
                    
                    console.log('è®¾ç½®å½“å‰è´¦æˆ·:', currentAccount);
                    console.log('Web3å®ä¾‹åˆ›å»ºæˆåŠŸ');
                    
                    // åˆå§‹åŒ–åˆçº¦å®ä¾‹
                    if (CONTRACT_ADDRESS && CONTRACT_ADDRESS !== "0x1234567890123456789012345678901234567890") {
                        contractInstance = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                        console.log('åˆçº¦å®ä¾‹åˆ›å»ºæˆåŠŸ');
                    }
                    
                    console.log('å¼€å§‹æ›´æ–°UI...');
                    await updateWalletUI();
                    setupEventListeners();
                    showNotification('MetaMaskè¿æ¥æˆåŠŸï¼', 'success');
                    
                    // åˆ‡æ¢åˆ°çœŸå®åˆçº¦æ¨¡å¼
                    if (contractInstance) {
                        loadRealContractData();
                    }
                } else {
                    console.log('æ²¡æœ‰è·å–åˆ°è´¦æˆ·');
                    showNotification('æœªè·å–åˆ°è´¦æˆ·', 'error');
                }
            } catch (error) {
                console.error('è¿æ¥MetaMaskå¤±è´¥:', error);
                showNotification('è¿æ¥MetaMaskå¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ–­å¼€MetaMaskè¿æ¥
        function disconnectMetaMask() {
            currentAccount = null;
            web3 = null;
            contractInstance = null;
            updateWalletUI();
            showNotification('å·²æ–­å¼€MetaMaskè¿æ¥', 'warning');
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // ç›‘å¬è´¦æˆ·å˜åŒ–
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    disconnectMetaMask();
                } else {
                    currentAccount = accounts[0];
                    updateWalletUI();
                }
            });

            // ç›‘å¬ç½‘ç»œå˜åŒ–
            window.ethereum.on('chainChanged', (chainId) => {
                updateNetworkInfo();
                showNotification('ç½‘ç»œå·²åˆ‡æ¢', 'warning');
            });
        }

        // æ›´æ–°é’±åŒ…UI
        async function updateWalletUI() {
            const walletStatus = document.getElementById('walletStatus');
            const currentAccountEl = document.getElementById('currentAccount');
            const connectBtn = document.getElementById('connectWallet');
            const disconnectBtn = document.getElementById('disconnectWallet');
            const walletInfo = document.getElementById('walletInfo');

            if (currentAccount) {
                walletStatus.textContent = 'å·²è¿æ¥';
                currentAccountEl.textContent = formatAddress(currentAccount);
                connectBtn.style.display = 'none';
                disconnectBtn.style.display = 'inline-block';
                walletInfo.textContent = 'ğŸ¦Š MetaMaskå·²è¿æ¥';
                
                // æ›´æ–°ç½‘ç»œå’Œä½™é¢ä¿¡æ¯
                await updateNetworkInfo();
                await updateETHBalance();
            } else {
                walletStatus.textContent = 'æœªè¿æ¥';
                currentAccountEl.textContent = 'æœªè¿æ¥';
                connectBtn.style.display = 'inline-block';
                disconnectBtn.style.display = 'none';
                walletInfo.textContent = '';
                
                document.getElementById('networkName').textContent = 'æœªè¿æ¥';
                document.getElementById('ethBalance').textContent = '0 ETH';
            }
        }

        // æ›´æ–°ç½‘ç»œä¿¡æ¯
        async function updateNetworkInfo() {
            try {
                const chainId = await web3.eth.getChainId();
                const network = SUPPORTED_NETWORKS[chainId];
                const networkName = document.getElementById('networkName');
                
                if (network) {
                    networkName.textContent = network.name;
                } else {
                    networkName.textContent = `æœªçŸ¥ç½‘ç»œ (Chain ID: ${chainId})`;
                }
            } catch (error) {
                console.error('è·å–ç½‘ç»œä¿¡æ¯å¤±è´¥:', error);
            }
        }

        // æ›´æ–°ETHä½™é¢
        async function updateETHBalance() {
            try {
                const balance = await web3.eth.getBalance(currentAccount);
                const ethBalance = web3.utils.fromWei(balance, 'ether');
                document.getElementById('ethBalance').textContent = parseFloat(ethBalance).toFixed(4) + ' ETH';
            } catch (error) {
                console.error('è·å–ETHä½™é¢å¤±è´¥:', error);
            }
        }

        // åŠ è½½çœŸå®åˆçº¦æ•°æ®
        async function loadRealContractData() {
            try {
                if (!contractInstance) return;

                // è·å–æ€»ä¾›åº”é‡
                const totalSupply = await contractInstance.methods.totalSupply().call();
                
                // è·å–å½“å‰è´¦æˆ·ä½™é¢
                const userBalance = await contractInstance.methods.balanceOf(currentAccount).call();
                
                // æ›´æ–°UI
                document.getElementById('totalSupply').textContent = 
                    web3.utils.fromWei(totalSupply, 'ether') + ' STU';
                
                // æ›´æ–°ç”¨æˆ·ä½™é¢æ˜¾ç¤º
                updateUserBalance(userBalance);
                
                showNotification('å·²åŠ è½½çœŸå®åˆçº¦æ•°æ®', 'success');
            } catch (error) {
                console.error('åŠ è½½åˆçº¦æ•°æ®å¤±è´¥:', error);
                showNotification('åŠ è½½åˆçº¦æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®', 'warning');
            }
        }

        // æ›´æ–°ç”¨æˆ·ä½™é¢
        function updateUserBalance(balance) {
            // è¿™é‡Œå¯ä»¥æ·»åŠ ç”¨æˆ·ä½™é¢æ˜¾ç¤ºé€»è¾‘
            console.log('ç”¨æˆ·ä½™é¢:', web3.utils.fromWei(balance, 'ether'));
        }

        // æ ¼å¼åŒ–åœ°å€æ˜¾ç¤º
        function formatAddress(address) {
            if (!address) return 'æœªè¿æ¥';
            return address.slice(0, 6) + '...' + address.slice(-4);
        }

        // çœŸå®åˆçº¦çš„é“¸é€ å‡½æ•°
        async function realMint(to, amount, reason) {
            try {
                if (!contractInstance) {
                    showNotification('è¯·å…ˆè¿æ¥MetaMask', 'error');
                    return false;
                }

                const amountWei = web3.utils.toWei(amount.toString(), 'ether');
                
                // è°ƒç”¨æ™ºèƒ½åˆçº¦çš„mintå‡½æ•°
                const result = await contractInstance.methods.mint(to, amountWei, reason)
                    .send({ from: currentAccount });
                
                console.log('é“¸é€ äº¤æ˜“å“ˆå¸Œ:', result.transactionHash);
                addTransaction('é“¸é€ ', `é“¸é€  ${amount} STU ç»™ ${to} (${reason}) - äº¤æ˜“: ${result.transactionHash.slice(0, 10)}...`);
                return true;
            } catch (error) {
                console.error('é“¸é€ å¤±è´¥:', error);
                showNotification('é“¸é€ å¤±è´¥: ' + error.message, 'error');
                return false;
            }
        }

        // çœŸå®åˆçº¦çš„è½¬ç§»å‡½æ•°
        async function realTransfer(from, to, amount) {
            try {
                if (!contractInstance) {
                    showNotification('è¯·å…ˆè¿æ¥MetaMask', 'error');
                    return false;
                }

                const amountWei = web3.utils.toWei(amount.toString(), 'ether');
                
                const result = await contractInstance.methods.transfer(to, amountWei)
                    .send({ from: from });
                
                console.log('è½¬ç§»äº¤æ˜“å“ˆå¸Œ:', result.transactionHash);
                addTransaction('è½¬ç§»', `ä» ${formatAddress(from)} è½¬ç§» ${amount} STU åˆ° ${formatAddress(to)} - äº¤æ˜“: ${result.transactionHash.slice(0, 10)}...`);
                return true;
            } catch (error) {
                console.error('è½¬ç§»å¤±è´¥:', error);
                showNotification('è½¬ç§»å¤±è´¥: ' + error.message, 'error');
                return false;
            }
        }

        // æ£€æŸ¥æ˜¯å¦è¿æ¥äº†MetaMask
        function isMetaMaskConnected() {
            return currentAccount !== null;
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // æ·»åŠ äº¤æ˜“è®°å½•
        function addTransaction(type, details) {
            const list = document.getElementById('transactionList');
            const item = document.createElement('div');
            item.className = 'transaction-item';
            item.innerHTML = `<strong>${type}</strong> - ${details}`;
            list.insertBefore(item, list.firstChild);
        }

        // æ›´æ–°ç•Œé¢ä¿¡æ¯
        function updateUI() {
            document.getElementById('totalSupply').textContent = contractData.totalSupply.toLocaleString() + ' STU';
            document.getElementById('circulatingSupply').textContent = contractData.circulatingSupply.toLocaleString() + ' STU';
            document.getElementById('adminBalance').textContent = contractData.adminBalance.toLocaleString() + ' STU';
            
            const statusElement = document.getElementById('contractStatus');
            const statusIndicator = document.querySelector('.status-indicator');
            if (contractData.isPaused) {
                statusElement.textContent = 'å·²æš‚åœ';
                statusIndicator.className = 'status-indicator status-paused';
            } else {
                statusElement.textContent = 'è¿è¡Œä¸­';
                statusIndicator.className = 'status-indicator status-active';
            }
        }

        // é“¸é€ ä»£å¸
        async function mintTokens() {
            const address = document.getElementById('mintAddress').value;
            const amount = parseInt(document.getElementById('mintAmount').value);
            const reason = document.getElementById('mintReason').value;

            if (!address || !amount || amount <= 0) {
                showNotification('è¯·å¡«å†™å®Œæ•´çš„é“¸é€ ä¿¡æ¯', 'error');
                return;
            }

            if (amount > 1000) {
                showNotification('å•æ¬¡é“¸é€ ä¸èƒ½è¶…è¿‡1000 STU', 'error');
                return;
            }

            // å¦‚æœè¿æ¥äº†MetaMaskä¸”æœ‰çœŸå®åˆçº¦ï¼Œä½¿ç”¨çœŸå®åˆçº¦
            if (isMetaMaskConnected() && contractInstance) {
                const success = await realMint(address, amount, reason);
                if (success) {
                    // åˆ·æ–°åˆçº¦æ•°æ®
                    await loadRealContractData();
                }
                return;
            }

            // å¦åˆ™ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
            if (contractData.isPaused) {
                showNotification('åˆçº¦å·²æš‚åœï¼Œæ— æ³•é“¸é€ ä»£å¸', 'error');
                return;
            }

            // æ›´æ–°æ•°æ®
            contractData.totalSupply += amount;
            contractData.circulatingSupply += amount;
            contractData.balances[address] = (contractData.balances[address] || 0) + amount;

            updateUI();
            addTransaction('é“¸é€ ', `é“¸é€  ${amount} STU ç»™ ${address} (${reason})`);
            showNotification(`æˆåŠŸé“¸é€  ${amount} STU ç»™ ${address}`, 'success');
        }

        // ç®€åŒ–é“¸é€ 
        function mintSimple() {
            document.getElementById('mintReason').value = 'å­¦ä¹ æˆå°±';
            mintTokens();
        }

        // è½¬ç§»ä»£å¸
        function transferTokens() {
            if (contractData.isPaused) {
                showNotification('åˆçº¦å·²æš‚åœï¼Œæ— æ³•è½¬ç§»ä»£å¸', 'error');
                return;
            }

            const fromAddr = document.getElementById('fromAddress').value;
            const toAddr = document.getElementById('toAddress').value;
            const amount = parseInt(document.getElementById('transferAmount').value);

            if (!fromAddr || !toAddr || !amount || amount <= 0) {
                showNotification('è¯·å¡«å†™å®Œæ•´çš„è½¬ç§»ä¿¡æ¯', 'error');
                return;
            }

            if (!contractData.balances[fromAddr] || contractData.balances[fromAddr] < amount) {
                showNotification('å‘é€æ–¹ä½™é¢ä¸è¶³', 'error');
                return;
            }

            // æ›´æ–°æ•°æ®
            contractData.balances[fromAddr] -= amount;
            contractData.balances[toAddr] = (contractData.balances[toAddr] || 0) + amount;

            updateUI();
            addTransaction('è½¬ç§»', `ä» ${fromAddr} è½¬ç§» ${amount} STU åˆ° ${toAddr}`);
            showNotification(`æˆåŠŸè½¬ç§» ${amount} STU`, 'success');
        }

        // é”€æ¯ä»£å¸
        function burnTokens() {
            if (contractData.isPaused) {
                showNotification('åˆçº¦å·²æš‚åœï¼Œæ— æ³•é”€æ¯ä»£å¸', 'error');
                return;
            }

            const address = document.getElementById('burnAddress').value;
            const amount = parseInt(document.getElementById('burnAmount').value);
            const reason = document.getElementById('burnReason').value;

            if (!address || !amount || amount <= 0) {
                showNotification('è¯·å¡«å†™å®Œæ•´çš„é”€æ¯ä¿¡æ¯', 'error');
                return;
            }

            if (!contractData.balances[address] || contractData.balances[address] < amount) {
                showNotification('åœ°å€ä½™é¢ä¸è¶³', 'error');
                return;
            }

            // æ›´æ–°æ•°æ®
            contractData.balances[address] -= amount;
            contractData.totalSupply -= amount;
            contractData.circulatingSupply -= amount;

            updateUI();
            addTransaction('é”€æ¯', `${address} é”€æ¯ ${amount} STU (${reason})`);
            showNotification(`æˆåŠŸé”€æ¯ ${amount} STUï¼Œå…‘æ¢${reason}`, 'success');
        }

        // æš‚åœåˆçº¦
        function pauseContract() {
            contractData.isPaused = true;
            updateUI();
            addTransaction('ç®¡ç†', 'ç®¡ç†å‘˜æš‚åœäº†åˆçº¦');
            showNotification('åˆçº¦å·²æš‚åœ', 'warning');
        }

        // æ¢å¤åˆçº¦
        function unpauseContract() {
            contractData.isPaused = false;
            updateUI();
            addTransaction('ç®¡ç†', 'ç®¡ç†å‘˜æ¢å¤äº†åˆçº¦');
            showNotification('åˆçº¦å·²æ¢å¤è¿è¡Œ', 'success');
        }

        // ç´§æ€¥æš‚åœ
        function emergencyPause() {
            contractData.isPaused = true;
            updateUI();
            addTransaction('ç´§æ€¥ç®¡ç†', 'ç®¡ç†å‘˜ç´§æ€¥æš‚åœäº†åˆçº¦');
            showNotification('åˆçº¦å·²ç´§æ€¥æš‚åœ', 'error');
        }

        // åˆ·æ–°ä¿¡æ¯
        function refreshInfo() {
            updateUI();
            showNotification('ä¿¡æ¯å·²åˆ·æ–°', 'success');
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆ');
            
            // æ£€æŸ¥MetaMaskæ˜¯å¦å·²è¿æ¥
            if (typeof window.ethereum !== 'undefined') {
                console.log('æ£€æµ‹åˆ°MetaMask');
                window.ethereum.request({ method: 'eth_accounts' })
                    .then(accounts => {
                        if (accounts.length > 0) {
                            console.log('MetaMaskå·²è¿æ¥ï¼Œè‡ªåŠ¨è®¾ç½®');
                            currentAccount = accounts[0];
                            web3 = new Web3(window.ethereum);
                            
                            if (CONTRACT_ADDRESS && CONTRACT_ADDRESS !== "0x1234567890123456789012345678901234567890") {
                                contractInstance = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                            }
                            
                            updateWalletUI();
                            setupEventListeners();
                            
                            if (contractInstance) {
                                loadRealContractData();
                            }
                        }
                    })
                    .catch(error => {
                        console.error('æ£€æŸ¥è´¦æˆ·å¤±è´¥:', error);
                    });
            }
            
            updateUI();
        });

        // æ·»åŠ è°ƒè¯•æŒ‰é’®
        function debugConnection() {
            console.log('=== è¿æ¥è°ƒè¯•ä¿¡æ¯ ===');
            console.log('window.ethereum:', window.ethereum);
            console.log('currentAccount:', currentAccount);
            console.log('web3:', web3);
            console.log('contractInstance:', contractInstance);
            
            if (window.ethereum) {
                window.ethereum.request({ method: 'eth_accounts' })
                    .then(accounts => {
                        console.log('å½“å‰è´¦æˆ·åˆ—è¡¨:', accounts);
                    });
            }
        }

        // åˆå§‹åŒ–
        updateUI();
    </script>
</body>
</html>
